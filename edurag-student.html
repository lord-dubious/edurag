<!DOCTYPE html>
<html lang="en" data-theme="light">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>EduRAG â€” Ask anything about the university</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Fraunces:ital,opsz,wght@0,9..144,300;0,9..144,400;0,9..144,500;1,9..144,300;1,9..144,400&family=Cabinet+Grotesk:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">

<!--
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘  EduRAG â€” STUDENT FRONTEND                                   â•‘
â•‘  Public-facing chat UI for university knowledge base         â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘  COMPONENT MAPPING (Next.js implementation)                  â•‘
â•‘                                                              â•‘
â•‘  This file is the visual reference. In the actual Next.js    â•‘
â•‘  build, replace HTML sections with:                          â•‘
â•‘                                                              â•‘
â•‘  INPUT AREA â†’ AI Elements                                    â•‘
â•‘    <PromptInput>                                              â•‘
â•‘      <PromptInputBody>                                        â•‘
â•‘        <PromptInputTextarea>                                  â•‘
â•‘      <PromptInputFooter>                                      â•‘
â•‘        <PromptInputTools>                                     â•‘
â•‘        <PromptInputSubmit status={status}>                   â•‘
â•‘                                                              â•‘
â•‘  MESSAGES â†’ AI Elements                                      â•‘
â•‘    <Conversation>                                            â•‘
â•‘      <ConversationContent>                                   â•‘
â•‘        <ConversationEmptyState> (suggestion chips)           â•‘
â•‘        <Message from={role}>                                 â•‘
â•‘          <MessageContent>                                    â•‘
â•‘            <MessageResponse>{text}</MessageResponse>         â•‘
â•‘          <MessageActions>                                    â•‘
â•‘            <MessageAction> copy / regenerate                 â•‘
â•‘      <ConversationScrollButton>                              â•‘
â•‘                                                              â•‘
â•‘  CITATIONS â†’ AI Elements                                     â•‘
â•‘    <InlineCitation>                                          â•‘
â•‘      <InlineCitationCard>                                    â•‘
â•‘        <InlineCitationCardTrigger sources={[url]}>           â•‘
â•‘        <InlineCitationCardBody>                              â•‘
â•‘          <InlineCitationCarousel>                            â•‘
â•‘            <InlineCitationCarouselContent>                   â•‘
â•‘              <InlineCitationCarouselItem>                    â•‘
â•‘                <InlineCitationSource title url description>  â•‘
â•‘                                                              â•‘
â•‘  SHADCN COMPONENTS                                           â•‘
â•‘    Sheet       â†’ mobile session drawer                       â•‘
â•‘    Accordion   â†’ FAQ section                                 â•‘
â•‘    Badge       â†’ citation chips, ask-count tags              â•‘
â•‘    Skeleton    â†’ loading states                              â•‘
â•‘    Separator   â†’ section dividers                            â•‘
â•‘    Tooltip     â†’ button tooltips                             â•‘
â•‘    useToast    â†’ action confirmations                        â•‘
â•‘                                                              â•‘
â•‘  SESSION HISTORY                                             â•‘
â•‘    Storage: localStorage only (key: "edurag_sessions")       â•‘
â•‘    Never sent to server â€” each threadId is nanoid()          â•‘
â•‘    Server only receives threadId, never user identity        â•‘
â•‘    Sessions listed in sidebar are browser-local only         â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
-->

<style>
*, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

:root {
  /* Palette â€” warm off-white + deep forest green + warm slate */
  --bg:        #f4f1eb;
  --bg2:       #ece8e0;
  --bg3:       #e0dbd0;
  --surface:   #fdfcf9;
  --surface2:  #f8f5ef;
  --border:    #d6d0c4;
  --border-hi: #b8b09e;

  --text:      #18140e;
  --text2:     #5c5344;
  --text3:     #9a8e7e;

  --accent:       #1e4d2b;
  --accent-mid:   #2e7042;
  --accent-light: #e6efe9;
  --accent-glow:  rgba(30,77,43,0.10);
  --accent-dim:   rgba(30,77,43,0.06);

  --user-bg:   #18140e;
  --user-text: #f4f1eb;

  --warn:      #b83232;
  --warn-bg:   #fdf0f0;

  --gold:      #c08b30;
  --gold-bg:   #fdf6e8;

  --radius:    14px;
  --radius-sm: 9px;
  --radius-lg: 22px;
  --radius-xl: 28px;

  --shadow-sm: 0 1px 4px rgba(24,20,14,0.06);
  --shadow:    0 3px 16px rgba(24,20,14,0.09);
  --shadow-lg: 0 10px 48px rgba(24,20,14,0.13);

  --font-disp: 'Fraunces', Georgia, serif;
  --font-body: 'Cabinet Grotesk', system-ui, sans-serif;
  --font-mono: 'JetBrains Mono', 'Courier New', monospace;

  --sidebar-w: 264px;
  --header-h:  58px;
  --input-max: 720px;
  --chat-max:  700px;

  --ease: cubic-bezier(0.4, 0, 0.2, 1);
  --t:    0.16s;
}

[data-theme="dark"] {
  --bg:        #0e0c08;
  --bg2:       #161310;
  --bg3:       #1e1b16;
  --surface:   #141108;
  --surface2:  #100e0a;
  --border:    #282318;
  --border-hi: #3a3428;

  --text:      #f0ebe0;
  --text2:     #a09278;
  --text3:     #6a5e4a;

  --accent:       #4aaa68;
  --accent-mid:   #3d8e56;
  --accent-light: #0e1e12;
  --accent-glow:  rgba(74,170,104,0.12);
  --accent-dim:   rgba(74,170,104,0.05);

  --user-bg:   #1e1b14;
  --user-text: #f0ebe0;

  --warn:      #e05050;
  --warn-bg:   #180a0a;

  --gold:      #d4a030;
  --gold-bg:   #160e00;

  --shadow-sm: 0 1px 4px rgba(0,0,0,0.25);
  --shadow:    0 3px 16px rgba(0,0,0,0.35);
  --shadow-lg: 0 10px 48px rgba(0,0,0,0.5);
}

body {
  font-family: var(--font-body);
  background: var(--bg);
  color: var(--text);
  height: 100dvh;
  overflow: hidden;
  font-size: 14px;
  line-height: 1.6;
  -webkit-font-smoothing: antialiased;
}

/* â”€â”€ Layout shell â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.shell {
  display: flex;
  height: 100dvh;
  overflow: hidden;
}

/* â”€â”€ Sidebar â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.sidebar {
  width: var(--sidebar-w);
  flex-shrink: 0;
  background: var(--surface);
  border-right: 1px solid var(--border);
  display: flex;
  flex-direction: column;
  overflow: hidden;
  transition: width var(--t) var(--ease), opacity var(--t) var(--ease);
}
.sidebar.collapsed { width: 0; opacity: 0; pointer-events: none; }

.sidebar-top {
  padding: 16px 14px 10px;
  border-bottom: 1px solid var(--border);
  display: flex;
  align-items: center;
  gap: 10px;
}
.logo {
  display: flex;
  align-items: center;
  gap: 9px;
  font-family: var(--font-disp);
  font-size: 17px;
  font-weight: 400;
  color: var(--text);
  flex: 1;
}
.logo-mark {
  width: 32px; height: 32px;
  background: var(--accent);
  border-radius: 9px;
  display: flex; align-items: center; justify-content: center;
  flex-shrink: 0;
}
.logo-mark svg { stroke: white; }

.new-btn {
  width: 30px; height: 30px;
  border-radius: var(--radius-sm);
  border: 1px solid var(--border);
  background: transparent;
  color: var(--text2);
  cursor: pointer;
  display: flex; align-items: center; justify-content: center;
  transition: all var(--t);
  flex-shrink: 0;
}
.new-btn:hover { background: var(--bg2); color: var(--text); border-color: var(--border-hi); }

.sidebar-scroll {
  flex: 1;
  overflow-y: auto;
  padding: 10px 10px;
}
.sidebar-label {
  font-size: 10px;
  font-weight: 700;
  letter-spacing: 0.10em;
  text-transform: uppercase;
  color: var(--text3);
  padding: 8px 6px 4px;
}
.session {
  display: flex;
  align-items: center;
  gap: 8px;
  padding: 8px 8px;
  border-radius: var(--radius-sm);
  cursor: pointer;
  transition: background var(--t);
  position: relative;
}
.session:hover { background: var(--bg2); }
.session.active { background: var(--accent-light); }
.session.active .s-title { color: var(--accent); }
.s-icon {
  width: 26px; height: 26px;
  border-radius: 7px;
  background: var(--bg2);
  display: flex; align-items: center; justify-content: center;
  font-size: 13px;
  flex-shrink: 0;
}
.session.active .s-icon { background: var(--accent-dim); }
.s-info { flex: 1; min-width: 0; }
.s-title {
  font-size: 13px;
  font-weight: 500;
  color: var(--text);
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}
.s-time { font-size: 11px; color: var(--text3); }
.s-del {
  width: 18px; height: 18px;
  border-radius: 5px;
  border: none;
  background: transparent;
  color: var(--text3);
  cursor: pointer;
  display: flex; align-items: center; justify-content: center;
  font-size: 11px;
  opacity: 0;
  transition: all var(--t);
  flex-shrink: 0;
}
.session:hover .s-del { opacity: 1; }
.s-del:hover { background: var(--warn-bg); color: var(--warn); }

/* â”€â”€ Main area â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.main {
  flex: 1;
  display: flex;
  flex-direction: column;
  min-width: 0;
  position: relative;
  overflow: hidden;
}

/* â”€â”€ Topbar â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.topbar {
  height: var(--header-h);
  border-bottom: 1px solid var(--border);
  background: var(--surface);
  display: flex;
  align-items: center;
  padding: 0 16px;
  gap: 10px;
  flex-shrink: 0;
}
.topbar-toggle {
  width: 34px; height: 34px;
  border-radius: var(--radius-sm);
  border: 1px solid var(--border);
  background: transparent;
  color: var(--text2);
  cursor: pointer;
  display: flex; align-items: center; justify-content: center;
  transition: all var(--t);
  flex-shrink: 0;
}
.topbar-toggle:hover { background: var(--bg2); color: var(--text); }
.topbar-title {
  font-family: var(--font-disp);
  font-size: 15px;
  font-weight: 400;
  color: var(--text2);
  flex: 1;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}
.topbar-right { display: flex; align-items: center; gap: 6px; }
.icon-btn {
  width: 34px; height: 34px;
  border-radius: var(--radius-sm);
  border: 1px solid var(--border);
  background: transparent;
  color: var(--text2);
  cursor: pointer;
  display: flex; align-items: center; justify-content: center;
  transition: all var(--t);
}
.icon-btn:hover { background: var(--bg2); color: var(--text); border-color: var(--border-hi); }

/* â”€â”€ Content area (scroll) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.content {
  flex: 1;
  overflow-y: auto;
  scroll-behavior: smooth;
  position: relative;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   HOME STATE â€” chatbox + FAQs visible
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.home-view {
  display: flex;
  flex-direction: column;
  align-items: center;
  min-height: 100%;
  padding: 48px 24px 32px;
}
.home-view.hidden { display: none; }

.home-hero {
  text-align: center;
  margin-bottom: 32px;
  animation: fadeUp 0.5s var(--ease) both;
}
@keyframes fadeUp {
  from { opacity:0; transform:translateY(16px); }
  to   { opacity:1; transform:translateY(0); }
}
.hero-eyebrow {
  display: inline-flex;
  align-items: center;
  gap: 6px;
  font-size: 11px;
  font-weight: 700;
  letter-spacing: 0.10em;
  text-transform: uppercase;
  color: var(--accent);
  margin-bottom: 16px;
}
.hero-eyebrow::before, .hero-eyebrow::after {
  content: '';
  display: block;
  width: 24px; height: 1px;
  background: var(--accent);
  opacity: 0.4;
}
.hero-h1 {
  font-family: var(--font-disp);
  font-size: clamp(30px, 4.5vw, 50px);
  font-weight: 300;
  line-height: 1.12;
  letter-spacing: -0.02em;
  color: var(--text);
  margin-bottom: 14px;
}
.hero-h1 em {
  font-style: italic;
  color: var(--accent);
}
.hero-sub {
  font-size: 15px;
  color: var(--text2);
  font-weight: 300;
  max-width: 440px;
  margin: 0 auto;
  line-height: 1.7;
}

/* â”€â”€ Central input (home state) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
/*
  AI Elements mapping:
  <PromptInput onSubmit={...} className="home-input-wrap">
    <PromptInputBody>
      <PromptInputTextarea placeholder="..." />
    </PromptInputBody>
    <PromptInputFooter>
      <PromptInputTools>...</PromptInputTools>
      <PromptInputSubmit status={status} />
    </PromptInputFooter>
  </PromptInput>
*/
.home-input-wrap {
  width: 100%;
  max-width: var(--input-max);
  margin-bottom: 24px;
  animation: fadeUp 0.5s 0.08s var(--ease) both;
}
.input-box {
  background: var(--surface);
  border: 1.5px solid var(--border);
  border-radius: var(--radius-xl);
  padding: 14px 16px 10px;
  display: flex;
  flex-direction: column;
  gap: 10px;
  box-shadow: var(--shadow);
  transition: border-color var(--t), box-shadow var(--t);
}
.input-box:focus-within {
  border-color: var(--accent);
  box-shadow: 0 0 0 3px var(--accent-glow), var(--shadow);
}
.chat-textarea {
  width: 100%;
  border: none;
  outline: none;
  background: transparent;
  font-family: var(--font-body);
  font-size: 15px;
  color: var(--text);
  line-height: 1.6;
  resize: none;
  min-height: 26px;
  max-height: 180px;
}
.chat-textarea::placeholder { color: var(--text3); }
.input-row {
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: 8px;
}
.input-tools { display: flex; align-items: center; gap: 4px; }
.tool-chip {
  display: flex;
  align-items: center;
  gap: 5px;
  padding: 5px 10px;
  border-radius: 7px;
  border: 1px solid var(--border);
  background: transparent;
  color: var(--text3);
  font-size: 12px;
  font-weight: 500;
  cursor: pointer;
  transition: all var(--t);
  font-family: var(--font-body);
}
.tool-chip:hover { color: var(--text); border-color: var(--border-hi); background: var(--bg2); }
.tool-chip.active { background: var(--accent-light); border-color: var(--accent); color: var(--accent); }
.send-btn {
  width: 38px; height: 38px;
  border-radius: 11px;
  background: var(--accent);
  border: none;
  color: white;
  cursor: pointer;
  display: flex; align-items: center; justify-content: center;
  transition: all var(--t);
  flex-shrink: 0;
}
.send-btn:hover { opacity: 0.85; transform: scale(1.06); }
.send-btn:disabled {
  background: var(--bg3);
  color: var(--text3);
  cursor: not-allowed;
  transform: none;
}
.input-hint {
  text-align: center;
  font-size: 11px;
  color: var(--text3);
  margin-top: -8px;
  margin-bottom: 8px;
}

/* Suggestions
   shadcn: use <Button variant="outline"> per chip
*/
.suggestions {
  width: 100%;
  max-width: var(--input-max);
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 8px;
  margin-bottom: 40px;
  animation: fadeUp 0.5s 0.14s var(--ease) both;
}
.sugg-chip {
  display: flex;
  align-items: flex-start;
  gap: 8px;
  padding: 11px 14px;
  background: var(--surface);
  border: 1px solid var(--border);
  border-radius: var(--radius);
  font-size: 13px;
  color: var(--text2);
  cursor: pointer;
  text-align: left;
  transition: all var(--t);
  font-family: var(--font-body);
  line-height: 1.4;
}
.sugg-chip:hover {
  border-color: var(--accent);
  color: var(--accent);
  background: var(--accent-dim);
}
.sugg-icon {
  font-size: 14px;
  flex-shrink: 0;
  margin-top: 1px;
}

/* FAQ section
   shadcn: use <Accordion> with AccordionItem, AccordionTrigger, AccordionContent
*/
.faq-section {
  width: 100%;
  max-width: var(--input-max);
  animation: fadeUp 0.5s 0.20s var(--ease) both;
}
.faq-header {
  display: flex;
  align-items: center;
  gap: 12px;
  margin-bottom: 16px;
}
.faq-heading {
  font-family: var(--font-disp);
  font-size: 20px;
  font-weight: 400;
  color: var(--text);
}
.faq-rule {
  flex: 1;
  height: 1px;
  background: var(--border);
}
.faq-meta {
  font-size: 11px;
  color: var(--text3);
  white-space: nowrap;
}
.faq-list {
  display: flex;
  flex-direction: column;
  gap: 6px;
}
.faq-item {
  background: var(--surface);
  border: 1px solid var(--border);
  border-radius: var(--radius);
  overflow: hidden;
  transition: border-color var(--t), box-shadow var(--t);
}
.faq-item:hover { border-color: var(--border-hi); }
.faq-item.open { border-color: var(--accent); box-shadow: 0 0 0 2px var(--accent-glow); }
.faq-q {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 14px 16px;
  cursor: pointer;
  gap: 12px;
  user-select: none;
}
.faq-q-text { font-size: 13px; font-weight: 500; flex: 1; }
.faq-q-right {
  display: flex;
  align-items: center;
  gap: 8px;
  flex-shrink: 0;
}
.faq-count {
  /* shadcn: <Badge variant="secondary"> */
  background: var(--bg2);
  color: var(--text3);
  border-radius: 100px;
  padding: 2px 8px;
  font-size: 10px;
  font-weight: 600;
  font-family: var(--font-mono);
}
.faq-item.open .faq-count { background: var(--accent-light); color: var(--accent); }
.faq-toggle {
  width: 20px; height: 20px;
  border-radius: 6px;
  background: var(--bg2);
  display: flex; align-items: center; justify-content: center;
  color: var(--text3);
  font-size: 13px;
  transition: all var(--t);
}
.faq-item.open .faq-toggle {
  background: var(--accent);
  color: white;
  transform: rotate(45deg);
}
.faq-a {
  max-height: 0;
  overflow: hidden;
  transition: max-height 0.28s var(--ease), padding 0.18s;
  font-size: 13px;
  color: var(--text2);
  line-height: 1.72;
  padding: 0 16px;
}
.faq-item.open .faq-a { max-height: 220px; padding: 0 16px 14px; }
.faq-source {
  display: flex;
  align-items: center;
  gap: 5px;
  margin-top: 10px;
  font-size: 11px;
  color: var(--text3);
  font-family: var(--font-mono);
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   CHAT STATE â€” full message thread
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.chat-view {
  display: none;
  flex-direction: column;
  min-height: 100%;
  padding: 28px 24px 0;
}
.chat-view.visible { display: flex; }

.messages-wrap {
  flex: 1;
  max-width: var(--chat-max);
  width: 100%;
  margin: 0 auto;
  display: flex;
  flex-direction: column;
  gap: 28px;
  padding-bottom: 24px;
}

/* Message
   AI Elements: <Message from={role}><MessageContent><MessageResponse>
*/
.msg { display: flex; flex-direction: column; animation: msgIn 0.22s var(--ease); }
@keyframes msgIn { from { opacity:0; transform:translateY(8px); } to { opacity:1; transform:translateY(0); } }
.msg-user { align-items: flex-end; }
.msg-assistant { align-items: flex-start; }

.msg-meta {
  display: flex;
  align-items: center;
  gap: 7px;
  margin-bottom: 7px;
  font-size: 11px;
  color: var(--text3);
}
.msg-avatar {
  width: 22px; height: 22px;
  border-radius: 7px;
  background: var(--accent);
  display: flex; align-items: center; justify-content: center;
  font-size: 11px;
  color: white;
  flex-shrink: 0;
}
.msg-bubble {
  max-width: 86%;
  padding: 13px 16px;
  border-radius: var(--radius);
  font-size: 14px;
  line-height: 1.68;
}
.msg-user .msg-bubble {
  background: var(--user-bg);
  color: var(--user-text);
  border-bottom-right-radius: 4px;
}
.msg-assistant .msg-bubble {
  background: var(--surface);
  color: var(--text);
  border: 1px solid var(--border);
  border-bottom-left-radius: 4px;
  box-shadow: var(--shadow-sm);
  width: 100%;
  max-width: 100%;
}
.msg-bubble strong { font-weight: 600; }
.msg-bubble em { font-style: italic; color: var(--text2); }

/* Citations row
   AI Elements: <InlineCitation><InlineCitationCard>...
*/
.citations-row {
  display: flex;
  flex-wrap: wrap;
  gap: 5px;
  margin-top: 12px;
  padding-top: 10px;
  border-top: 1px solid var(--border);
}
.cite-chip {
  display: flex;
  align-items: center;
  gap: 5px;
  padding: 3px 9px;
  background: var(--accent-light);
  border: 1px solid rgba(30,77,43,0.15);
  border-radius: 100px;
  font-size: 11px;
  font-weight: 500;
  color: var(--accent);
  cursor: pointer;
  transition: all var(--t);
}
.cite-chip:hover { background: var(--accent); color: white; }
.cite-num {
  width: 15px; height: 15px;
  background: var(--accent);
  color: white;
  border-radius: 50%;
  font-size: 9px;
  display: flex; align-items: center; justify-content: center;
  font-family: var(--font-mono);
  flex-shrink: 0;
  transition: background var(--t);
}
.cite-chip:hover .cite-num { background: rgba(255,255,255,0.3); }

/* Message actions
   AI Elements: <MessageActions><MessageAction label="...">
*/
.msg-actions {
  display: flex;
  gap: 4px;
  margin-top: 6px;
  opacity: 0;
  transition: opacity var(--t);
}
.msg:hover .msg-actions { opacity: 1; }
.msg-act {
  width: 27px; height: 27px;
  border-radius: 7px;
  border: 1px solid var(--border);
  background: var(--surface);
  color: var(--text3);
  cursor: pointer;
  display: flex; align-items: center; justify-content: center;
  transition: all var(--t);
}
.msg-act:hover { color: var(--text); border-color: var(--border-hi); }

/* Streaming cursor */
.cursor {
  display: inline-block;
  width: 2px; height: 15px;
  background: var(--accent);
  margin-left: 2px;
  vertical-align: text-bottom;
  animation: blink 0.85s step-end infinite;
}
@keyframes blink { 50% { opacity: 0; } }

/* â”€â”€ Sticky input bar (chat state) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
/*
  AI Elements: <PromptInput> wrapping textarea + submit
  Positioned sticky at bottom of .content
*/
.sticky-input {
  position: sticky;
  bottom: 0;
  background: linear-gradient(to top, var(--bg) 70%, transparent);
  padding: 16px 24px 20px;
  z-index: 10;
}
.sticky-input-inner {
  max-width: var(--chat-max);
  margin: 0 auto;
  background: var(--surface);
  border: 1.5px solid var(--border);
  border-radius: var(--radius-xl);
  padding: 12px 14px 10px;
  box-shadow: var(--shadow);
  transition: border-color var(--t), box-shadow var(--t);
}
.sticky-input-inner:focus-within {
  border-color: var(--accent);
  box-shadow: 0 0 0 3px var(--accent-glow), var(--shadow);
}

/* Sources panel (slide-in) */
.sources-overlay {
  position: fixed;
  inset: 0;
  z-index: 200;
  pointer-events: none;
}
.sources-panel {
  /* shadcn: use <Sheet> for mobile */
  position: absolute;
  top: 0; right: 0; bottom: 0;
  width: 300px;
  background: var(--surface);
  border-left: 1px solid var(--border);
  display: flex;
  flex-direction: column;
  transform: translateX(100%);
  transition: transform 0.24s var(--ease);
  pointer-events: all;
  box-shadow: var(--shadow-lg);
}
.sources-panel.open { transform: translateX(0); }
.sources-head {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 14px 16px;
  border-bottom: 1px solid var(--border);
}
.sources-title { font-size: 13px; font-weight: 600; }
.sources-badge {
  /* shadcn: <Badge> */
  background: var(--accent-light);
  color: var(--accent);
  border-radius: 100px;
  padding: 2px 8px;
  font-size: 11px;
  font-weight: 600;
}
.sources-body {
  flex: 1;
  overflow-y: auto;
  padding: 10px;
  display: flex;
  flex-direction: column;
  gap: 8px;
}
.source-card {
  background: var(--surface2);
  border: 1px solid var(--border);
  border-radius: var(--radius-sm);
  padding: 12px;
  cursor: pointer;
  transition: all var(--t);
}
.source-card:hover { border-color: var(--accent); }
.source-card.active { border-color: var(--accent); box-shadow: 0 0 0 2px var(--accent-glow); }
.sc-top { display: flex; align-items: flex-start; gap: 8px; margin-bottom: 6px; }
.sc-favicon {
  width: 20px; height: 20px;
  border-radius: 5px;
  background: var(--bg2);
  display: flex; align-items: center; justify-content: center;
  font-size: 10px; color: var(--text3);
  flex-shrink: 0;
}
.sc-title { font-size: 12px; font-weight: 600; color: var(--text); line-height: 1.4; }
.sc-url { font-size: 10px; color: var(--accent); font-family: var(--font-mono); margin-top: 1px; }
.sc-snippet { font-size: 11px; color: var(--text2); line-height: 1.55; }
.sc-score {
  display: inline-block;
  margin-top: 6px;
  background: var(--bg2);
  border-radius: 4px;
  padding: 1px 6px;
  font-size: 10px;
  color: var(--text3);
  font-family: var(--font-mono);
}

/* â”€â”€ Sources toggle button â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.sources-toggle {
  display: flex;
  align-items: center;
  gap: 6px;
  padding: 5px 10px;
  border-radius: 7px;
  border: 1px solid var(--border);
  background: var(--surface);
  color: var(--text2);
  font-size: 12px;
  font-weight: 500;
  cursor: pointer;
  transition: all var(--t);
  font-family: var(--font-body);
}
.sources-toggle:hover { border-color: var(--accent); color: var(--accent); }
.sources-toggle .dot {
  width: 6px; height: 6px;
  background: var(--accent);
  border-radius: 50%;
}

/* â”€â”€ Toast
   shadcn: use useToast() hook
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.toasts {
  position: fixed;
  bottom: 24px; left: 50%;
  transform: translateX(-50%);
  z-index: 9999;
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 8px;
  pointer-events: none;
}
.toast {
  background: var(--text);
  color: var(--bg);
  padding: 9px 16px;
  border-radius: var(--radius-sm);
  font-size: 12px;
  font-weight: 500;
  box-shadow: var(--shadow-lg);
  animation: toastIn 0.22s var(--ease);
  white-space: nowrap;
  display: flex;
  align-items: center;
  gap: 7px;
}
@keyframes toastIn { from { opacity:0; transform:translateY(8px); } to { opacity:1; transform:translateY(0); } }

/* â”€â”€ Scroll utilities â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
::-webkit-scrollbar { width: 4px; }
::-webkit-scrollbar-thumb { background: var(--bg3); border-radius: 4px; }

/* â”€â”€ Close overlay â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.overlay-bg {
  position: fixed;
  inset: 0;
  z-index: 190;
  display: none;
}
.overlay-bg.open { display: block; }
</style>
</head>
<body>

<div class="shell">

  <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       LEFT SIDEBAR â€” LOCAL SESSION HISTORY

       âš™ Implementation notes:
       - Sessions stored in localStorage key "edurag_sessions"
       - Shape: [{ id: nanoid(), title: string, ts: number }]
       - threadId is nanoid() â€” never tied to user identity
       - Server only receives threadId (used for vector search scope)
       - Session title = first 50 chars of first user message
       - Deleting a session: removes from localStorage + calls
         DELETE /api/threads?threadId={id} to clear conversation
         history from MongoDB conversations collection
       - No login required â€” sessions are browser-local only
       â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <aside class="sidebar" id="sidebar">
    <div class="sidebar-top">
      <div class="logo">
        <div class="logo-mark">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2.2">
            <path d="M22 10v6M2 10l10-5 10 5-10 5z"/>
            <path d="M6 12v5c3 3 9 3 12 0v-5"/>
          </svg>
        </div>
        EduRAG
      </div>
      <button class="new-btn" onclick="newChat()" title="New chat">
        <svg width="13" height="13" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><path d="M12 5v14M5 12h14"/></svg>
      </button>
    </div>

    <div class="sidebar-scroll">
      <!--
        Sessions from localStorage rendered here.
        shadcn: each .session can use <Button variant="ghost"> styling
        No server call on click â€” just load messages from local state
        or re-render the chat view for that threadId
      -->
      <div class="sidebar-label">Today</div>
      <div class="session active" onclick="loadSession(this)">
        <div class="s-icon">ğŸ“</div>
        <div class="s-info">
          <div class="s-title">Admission requirements</div>
          <div class="s-time">2 min ago</div>
        </div>
        <button class="s-del" onclick="delSession(event, this)" title="Delete">âœ•</button>
      </div>
      <div class="session" onclick="loadSession(this)">
        <div class="s-icon">ğŸ’°</div>
        <div class="s-info">
          <div class="s-title">Tuition &amp; scholarships</div>
          <div class="s-time">1h ago</div>
        </div>
        <button class="s-del" onclick="delSession(event, this)" title="Delete">âœ•</button>
      </div>
      <div class="sidebar-label">Yesterday</div>
      <div class="session" onclick="loadSession(this)">
        <div class="s-icon">ğŸ </div>
        <div class="s-info">
          <div class="s-title">On-campus housing</div>
          <div class="s-time">Yesterday</div>
        </div>
        <button class="s-del" onclick="delSession(event, this)" title="Delete">âœ•</button>
      </div>
      <div class="session" onclick="loadSession(this)">
        <div class="s-icon">ğŸ“š</div>
        <div class="s-info">
          <div class="s-title">CS program overview</div>
          <div class="s-time">Yesterday</div>
        </div>
        <button class="s-del" onclick="delSession(event, this)" title="Delete">âœ•</button>
      </div>
    </div>
  </aside>

  <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       MAIN COLUMN
  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <main class="main">

    <!-- Topbar -->
    <header class="topbar">
      <button class="topbar-toggle" onclick="toggleSidebar()" title="Toggle history">
        <svg width="15" height="15" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <line x1="3" y1="6" x2="21" y2="6"/><line x1="3" y1="12" x2="21" y2="12"/><line x1="3" y1="18" x2="21" y2="18"/>
        </svg>
      </button>
      <span class="topbar-title" id="topbar-title">University Knowledge Base</span>
      <div class="topbar-right">
        <button class="sources-toggle" id="sources-btn" onclick="toggleSources()" style="display:none">
          <span class="dot"></span>
          Sources <span id="src-count">0</span>
        </button>
        <button class="icon-btn" onclick="toggleTheme()" title="Toggle theme">
          <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <circle cx="12" cy="12" r="5"/>
            <path d="M12 1v2M12 21v2M4.22 4.22l1.42 1.42M18.36 18.36l1.42 1.42M1 12h2M21 12h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42"/>
          </svg>
        </button>
      </div>
    </header>

    <!-- Scrollable content -->
    <div class="content" id="content">

      <!-- â”€â”€ HOME VIEW â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
           Shown on first load and when no active chat
           Becomes hidden once first message is sent
      â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
      <div class="home-view" id="home-view">

        <div class="home-hero">
          <div class="hero-eyebrow">Knowledge Base</div>
          <h1 class="hero-h1">Ask anything about<br><em>the university</em></h1>
          <p class="hero-sub">Cited answers from official university pages â€” admissions, programs, tuition, deadlines, and campus life.</p>
        </div>

        <!-- Central prompt input (home state)
             â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
             AI Elements: <PromptInput onSubmit={handleSubmit}>
               <PromptInputBody>
                 <PromptInputTextarea placeholder="..."/>
               </PromptInputBody>
               <PromptInputFooter>
                 <PromptInputTools>
                   <PromptInputButton tooltip="Knowledge Base" class={active}>ğŸ”</PromptInputButton>
                 </PromptInputTools>
                 <PromptInputSubmit status={status}/>
               </PromptInputFooter>
             </PromptInput>
        -->
        <div class="home-input-wrap">
          <div class="input-box">
            <textarea
              class="chat-textarea"
              id="home-input"
              placeholder="Ask about admissions, programs, tuition, deadlinesâ€¦"
              rows="1"
              onkeydown="handleKey(event,'home-input')"
              oninput="resize(this); toggleSend('home-send', this.value)"
            ></textarea>
            <div class="input-row">
              <div class="input-tools">
                <button class="tool-chip active">
                  <svg width="11" height="11" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="11" cy="11" r="8"/><path d="m21 21-4.35-4.35"/></svg>
                  Knowledge Base
                </button>
              </div>
              <button class="send-btn" id="home-send" onclick="sendFromHome()" disabled>
                <svg width="15" height="15" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><path d="M22 2 11 13M22 2 15 22 11 13 2 9l20-7z"/></svg>
              </button>
            </div>
          </div>
          <div class="input-hint">EduRAG searches official university pages Â· Verify critical info directly with the university</div>
        </div>

        <!-- Suggestion chips
             shadcn: <Button variant="outline"> per chip
        -->
        <div class="suggestions">
          <button class="sugg-chip" onclick="useSugg(this)">
            <span class="sugg-icon">ğŸ“</span>
            What are the undergraduate admission requirements?
          </button>
          <button class="sugg-chip" onclick="useSugg(this)">
            <span class="sugg-icon">ğŸ’°</span>
            How much is tuition per semester?
          </button>
          <button class="sugg-chip" onclick="useSugg(this)">
            <span class="sugg-icon">ğŸŒ</span>
            Scholarships available for international students?
          </button>
          <button class="sugg-chip" onclick="useSugg(this)">
            <span class="sugg-icon">ğŸ </span>
            Is on-campus housing guaranteed for first years?
          </button>
        </div>

        <!-- FAQ Section
             â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
             Fetched from GET /api/faqs (public endpoint)
             Next.js: export const revalidate = 3600 (ISR, 1hr)
             shadcn: <Accordion type="single" collapsible>
               <AccordionItem value="faq-{i}">
                 <AccordionTrigger>
                   {question}
                   <Badge variant="secondary">{count} asks</Badge>
                 </AccordionTrigger>
                 <AccordionContent>{answer}</AccordionContent>
               </AccordionItem>
             â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        -->
        <div class="faq-section">
          <div class="faq-header">
            <h2 class="faq-heading">Frequently Asked</h2>
            <div class="faq-rule"></div>
            <span class="faq-meta">Auto-generated Â· updated hourly</span>
          </div>
          <div class="faq-list" id="faq-list"></div>
        </div>

      </div><!-- /home-view -->

      <!-- â”€â”€ CHAT VIEW â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
           Shown after first message is sent
           AI Elements: <Conversation><ConversationContent>
      â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
      <div class="chat-view" id="chat-view">
        <div class="messages-wrap" id="messages-wrap"></div>
      </div>

      <!-- Sticky input (chat state)
           AI Elements: <PromptInput> same as home, just in sticky position
      -->
      <div class="sticky-input" id="sticky-input" style="display:none">
        <div class="sticky-input-inner">
          <textarea
            class="chat-textarea"
            id="chat-input"
            placeholder="Ask a follow-upâ€¦"
            rows="1"
            onkeydown="handleKey(event,'chat-input')"
            oninput="resize(this); toggleSend('chat-send', this.value)"
          ></textarea>
          <div class="input-row" style="margin-top:6px;">
            <div class="input-tools">
              <button class="tool-chip active">
                <svg width="11" height="11" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="11" cy="11" r="8"/><path d="m21 21-4.35-4.35"/></svg>
                Knowledge Base
              </button>
            </div>
            <button class="send-btn" id="chat-send" onclick="sendFromChat()" disabled>
              <svg width="15" height="15" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><path d="M22 2 11 13M22 2 15 22 11 13 2 9l20-7z"/></svg>
            </button>
          </div>
        </div>
      </div>

    </div><!-- /content -->
  </main>
</div><!-- /shell -->

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     SOURCES PANEL
     shadcn: use <Sheet side="right"> for mobile-friendly version
     Open via topbar "Sources N" button
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div class="overlay-bg" id="overlay-bg" onclick="closeSources()"></div>
<div class="sources-overlay">
  <div class="sources-panel" id="sources-panel">
    <div class="sources-head">
      <span class="sources-title">Sources</span>
      <div style="display:flex;align-items:center;gap:8px;">
        <span class="sources-badge" id="sources-badge">0</span>
        <button class="icon-btn" onclick="closeSources()" style="width:26px;height:26px;font-size:12px;">âœ•</button>
      </div>
    </div>
    <div class="sources-body" id="sources-body">
      <div style="padding:24px;text-align:center;color:var(--text3);font-size:13px;">
        Sources from retrieved pages appear here after each answer.
      </div>
    </div>
  </div>
</div>

<!-- Toast container -->
<div class="toasts" id="toasts"></div>

<script>
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  LOCAL STORAGE â€” Session management
//
//  Sessions are stored ONLY in the browser.
//  The server never knows who the user is.
//  threadId is a random nanoid() scoped to this browser.
//
//  localStorage schema:
//  "edurag_sessions": [
//    { id: "abc123", title: "Admission requirements", ts: 1708000000 }
//  ]
//  "edurag_msgs_{threadId}": [ ...messages array ]
//
//  On DELETE: localStorage item removed + DELETE /api/threads?threadId={id}
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// â”€â”€ FAQ data (would come from GET /api/faqs, ISR) â”€â”€
const FAQ_DATA = [
  {
    q: 'What are the undergraduate admission requirements?',
    a: 'Applicants must submit a completed application, official high school transcripts (minimum 3.0 GPA recommended), SAT/ACT scores â€” test-optional for Fall 2026 â€” two letters of recommendation, and a personal essay of up to 650 words.',
    count: 42,
    src: 'university.edu/admissions'
  },
  {
    q: 'How much is tuition per semester?',
    a: 'For the 2025â€“2026 academic year, tuition is $24,500 per semester for full-time undergraduates. Mandatory fees add $650/semester. Estimated total cost of attendance including housing and meals is approximately $72,000/year.',
    count: 31,
    src: 'university.edu/tuition'
  },
  {
    q: 'What scholarships are available for international students?',
    a: 'International students may apply for the Global Excellence Scholarship (up to $10,000/year), the International Merit Award, and need-based aid via the CSS Profile. Scholarship consideration is automatic during the admissions review.',
    count: 28,
    src: 'university.edu/scholarships'
  },
  {
    q: 'Is on-campus housing guaranteed for first-year students?',
    a: 'Yes. All first-year students who submit a housing application by June 1 are guaranteed on-campus accommodation. Options include traditional double rooms, suite-style, and single rooms across four residence halls.',
    count: 19,
    src: 'university.edu/housing'
  },
  {
    q: 'How do I apply for financial aid?',
    a: 'Submit the FAFSA (Free Application for Federal Student Aid) by February 15 for priority consideration. Domestic students should also complete the university\'s own aid application through the student portal. Award letters are sent by April 1.',
    count: 17,
    src: 'university.edu/financial-aid'
  }
];

// Build FAQ list
(function buildFaqs() {
  const list = document.getElementById('faq-list');
  list.innerHTML = FAQ_DATA.map((f, i) => `
    <div class="faq-item" id="fi-${i}">
      <div class="faq-q" onclick="toggleFaq(${i})">
        <span class="faq-q-text">${f.q}</span>
        <div class="faq-q-right">
          <span class="faq-count">${f.count}</span>
          <div class="faq-toggle">+</div>
        </div>
      </div>
      <div class="faq-a">
        ${f.a}
        <div class="faq-source">
          <svg width="10" height="10" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><line x1="2" y1="12" x2="22" y2="12"/><path d="M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z"/></svg>
          ${f.src}
        </div>
      </div>
    </div>`).join('');
})();

function toggleFaq(i) {
  const el = document.getElementById('fi-' + i);
  el.classList.toggle('open');
}

// â”€â”€ Theme â”€â”€
function toggleTheme() {
  document.documentElement.dataset.theme =
    document.documentElement.dataset.theme === 'dark' ? 'light' : 'dark';
}

// â”€â”€ Sidebar â”€â”€
function toggleSidebar() {
  document.getElementById('sidebar').classList.toggle('collapsed');
}

function loadSession(el) {
  document.querySelectorAll('.session').forEach(s => s.classList.remove('active'));
  el.classList.add('active');
  const title = el.querySelector('.s-title').textContent;
  document.getElementById('topbar-title').textContent = title;
  showToast('Session loaded from your device');
}

function delSession(e, btn) {
  e.stopPropagation();
  const item = btn.closest('.session');
  item.style.transition = '0.18s'; item.style.opacity = '0'; item.style.transform = 'translateX(-8px)';
  setTimeout(() => item.remove(), 180);
  // In real app: localStorage.removeItem('edurag_msgs_' + threadId)
  // + DELETE /api/threads?threadId={id}
  showToast('Chat removed from this device');
}

// â”€â”€ Input helpers â”€â”€
function resize(el) {
  el.style.height = 'auto';
  el.style.height = Math.min(el.scrollHeight, 180) + 'px';
}

function toggleSend(btnId, val) {
  document.getElementById(btnId).disabled = !val.trim();
}

function handleKey(e, inputId) {
  if (e.key === 'Enter' && !e.shiftKey) {
    e.preventDefault();
    inputId === 'home-input' ? sendFromHome() : sendFromChat();
  }
}

function useSugg(btn) {
  const text = btn.textContent.trim().replace(/^[^\s]+\s/, '');
  document.getElementById('home-input').value = text;
  resize(document.getElementById('home-input'));
  toggleSend('home-send', text);
  sendFromHome();
}

// â”€â”€ Chat flow â”€â”€
let inChat = false;
let msgCount = 0;

function sendFromHome() {
  const ta = document.getElementById('home-input');
  const text = ta.value.trim();
  if (!text) return;
  if (!inChat) activateChatView();
  ta.value = ''; resize(ta); toggleSend('home-send', '');
  doSend(text);
}

function sendFromChat() {
  const ta = document.getElementById('chat-input');
  const text = ta.value.trim();
  if (!text) return;
  ta.value = ''; resize(ta); toggleSend('chat-send', '');
  doSend(text);
}

function activateChatView() {
  inChat = true;
  document.getElementById('home-view').classList.add('hidden');
  document.getElementById('chat-view').classList.add('visible');
  document.getElementById('sticky-input').style.display = 'block';
  document.getElementById('topbar-title').textContent = 'New conversation';
  // Add session to sidebar (localStorage in real app)
  addSessionToSidebar('New conversation');
}

function addSessionToSidebar(title) {
  const scroll = document.querySelector('.sidebar-scroll');
  const label = scroll.querySelector('.sidebar-label');
  const div = document.createElement('div');
  div.className = 'session active';
  div.onclick = function() { loadSession(this); };
  div.innerHTML = `
    <div class="s-icon">ğŸ’¬</div>
    <div class="s-info">
      <div class="s-title">${title}</div>
      <div class="s-time">Just now</div>
    </div>
    <button class="s-del" onclick="delSession(event, this)">âœ•</button>`;
  document.querySelectorAll('.session').forEach(s => s.classList.remove('active'));
  scroll.insertBefore(div, label);
}

function newChat() {
  inChat = false;
  msgCount = 0;
  document.getElementById('home-view').classList.remove('hidden');
  document.getElementById('chat-view').classList.remove('visible');
  document.getElementById('chat-view').innerHTML = '<div class="messages-wrap" id="messages-wrap"></div>';
  document.getElementById('sticky-input').style.display = 'none';
  document.getElementById('topbar-title').textContent = 'University Knowledge Base';
  document.getElementById('home-input').value = '';
  document.getElementById('sources-btn').style.display = 'none';
  closeSources();
  clearSources();
  document.querySelectorAll('.session').forEach(s => s.classList.remove('active'));
}

const RESPONSES = [
  {
    text: `Based on the official admissions page, undergraduate applicants must submit:\n\n**Academic documents**\n- Completed application (Common App or university portal)\n- Official high school transcripts â€” minimum 3.0 GPA recommended\n- SAT/ACT scores (test-optional for Fall 2026)\n- Two letters of recommendation (one academic, one personal)\n- Personal essay â€” up to 650 words\n\n**Key deadlines**\n- Early Decision: November 1\n- Regular Decision: January 15\n- Transfer: April 1\n\nInternational applicants must also submit TOEFL (min 90) or IELTS (min 6.5) scores.`,
    srcs: [
      { t: 'Undergraduate Admissions', u: 'university.edu/admissions', s: 'Complete guide to freshman admission requirements and evaluation criteriaâ€¦', sc: 0.96 },
      { t: 'Application Deadlines', u: 'university.edu/admissions/deadlines', s: 'Important dates for the 2025â€“2026 application cycle, including ED and RDâ€¦', sc: 0.91 },
      { t: 'International Applicants', u: 'university.edu/admissions/international', s: 'Language requirements and additional steps for international studentsâ€¦', sc: 0.84 },
    ]
  },
  {
    text: `For the **2025â€“2026 academic year**:\n\n**Tuition:** $24,500/semester ($49,000/year)\n\n**Mandatory fees per semester**\n- Student services: $450\n- Technology: $200\n- Health center: $175\n\n**Estimated annual cost of attendance:** ~$72,000 (includes room, board, and personal expenses)\n\nOver 65% of students receive some form of aid. The average package is $18,400. Submit your FAFSA by **February 15** for priority consideration.`,
    srcs: [
      { t: 'Tuition & Fees 2025â€“26', u: 'university.edu/tuition', s: 'Complete breakdown of tuition, mandatory fees, and estimated costsâ€¦', sc: 0.98 },
      { t: 'Financial Aid Overview', u: 'university.edu/financial-aid', s: 'Types of aid available, eligibility, and how to applyâ€¦', sc: 0.89 },
    ]
  }
];
let respIdx = 0;

async function doSend(text) {
  msgCount++;
  appendUserMsg(text);
  if (msgCount === 1) {
    const title = text.slice(0, 48) + (text.length > 48 ? 'â€¦' : '');
    document.getElementById('topbar-title').textContent = title;
    const s = document.querySelector('.session.active .s-title');
    if (s) s.textContent = title;
    // localStorage.setItem('edurag_sessions', JSON.stringify([{id, title, ts}]));
  }
  scrollBot();
  await sleep(380);
  const resp = RESPONSES[respIdx % RESPONSES.length];
  respIdx++;
  await streamResp(resp.text, resp.srcs);
  scrollBot();
}

function appendUserMsg(text) {
  const wrap = document.getElementById('messages-wrap');
  const d = document.createElement('div');
  d.className = 'msg msg-user';
  d.innerHTML = `<div class="msg-bubble">${esc(text)}</div>`;
  wrap.appendChild(d);
}

async function streamResp(text, srcs) {
  const wrap = document.getElementById('messages-wrap');
  const d = document.createElement('div');
  d.className = 'msg msg-assistant';
  d.innerHTML = `
    <div class="msg-meta">
      <div class="msg-avatar">âœ¦</div>
      <span>EduRAG</span>
    </div>
    <div class="msg-bubble" id="mb-${msgCount}"></div>
    <div class="msg-actions">
      <button class="msg-act" onclick="copyMsg(this)" title="Copy">
        <svg width="11" height="11" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="9" y="9" width="13" height="13" rx="2"/><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"/></svg>
      </button>
      <button class="msg-act" title="Regenerate" onclick="showToast('Regeneratingâ€¦')">
        <svg width="11" height="11" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="1,4 1,10 7,10"/><path d="M3.51 15a9 9 0 1 0 .49-4.95"/></svg>
      </button>
    </div>`;
  wrap.appendChild(d);

  const bubble = document.getElementById('mb-' + msgCount);
  const words = text.split(' ');
  let built = '';
  bubble.innerHTML = '<span class="cursor"></span>';

  for (let i = 0; i < words.length; i++) {
    built += (i > 0 ? ' ' : '') + words[i];
    bubble.innerHTML = md(built) + '<span class="cursor"></span>';
    if (i % 4 === 0) scrollBot();
    await sleep(16 + Math.random() * 12);
  }
  bubble.innerHTML = md(text);
  // Add citations
  const row = document.createElement('div');
  row.className = 'citations-row';
  srcs.forEach((s, i) => {
    const c = document.createElement('div');
    c.className = 'cite-chip';
    c.innerHTML = `<span class="cite-num">${i+1}</span>${s.t}`;
    c.onclick = () => { openSources(); highlightSrc(i); };
    row.appendChild(c);
  });
  bubble.appendChild(row);
  // Update sources panel
  setSources(srcs);
}

function setSources(srcs) {
  const body = document.getElementById('sources-body');
  const badge = document.getElementById('sources-badge');
  const count = document.getElementById('src-count');
  badge.textContent = srcs.length;
  count.textContent = srcs.length;
  document.getElementById('sources-btn').style.display = srcs.length ? 'flex' : 'none';
  body.innerHTML = srcs.map((s, i) => `
    <div class="source-card" id="sc-${i}" onclick="highlightSrc(${i})">
      <div class="sc-top">
        <div class="sc-favicon">ğŸŒ</div>
        <div>
          <div class="sc-title">${s.t}</div>
          <div class="sc-url">${s.u}</div>
        </div>
      </div>
      <div class="sc-snippet">${s.s}</div>
      <span class="sc-score">relevance: ${s.sc}</span>
    </div>`).join('');
}

function clearSources() {
  document.getElementById('sources-body').innerHTML = `<div style="padding:24px;text-align:center;color:var(--text3);font-size:13px;">Sources from retrieved pages appear here after each answer.</div>`;
  document.getElementById('sources-badge').textContent = '0';
  document.getElementById('src-count').textContent = '0';
}

function highlightSrc(i) {
  document.querySelectorAll('.source-card').forEach(c => c.classList.remove('active'));
  const el = document.getElementById('sc-' + i);
  if (el) { el.classList.add('active'); el.scrollIntoView({ behavior: 'smooth', block: 'nearest' }); }
}

function openSources() {
  document.getElementById('sources-panel').classList.add('open');
  document.getElementById('overlay-bg').classList.add('open');
}
function closeSources() {
  document.getElementById('sources-panel').classList.remove('open');
  document.getElementById('overlay-bg').classList.remove('open');
}
function toggleSources() {
  document.getElementById('sources-panel').classList.contains('open') ? closeSources() : openSources();
}

function copyMsg(btn) {
  const bubble = btn.closest('.msg').querySelector('.msg-bubble');
  navigator.clipboard.writeText(bubble.innerText);
  showToast('Copied to clipboard');
}

function scrollBot() {
  const c = document.getElementById('content');
  c.scrollTop = c.scrollHeight;
}

function md(t) {
  return t
    .replace(/\*\*(.+?)\*\*/g, '<strong>$1</strong>')
    .replace(/\*(.+?)\*/g, '<em>$1</em>')
    .replace(/\n- /g, '<br>â€¢ ')
    .replace(/\n/g, '<br>');
}
function esc(t) { return t.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;'); }
function sleep(ms) { return new Promise(r => setTimeout(r, ms)); }

function showToast(msg, dur = 2500) {
  const w = document.getElementById('toasts');
  const t = document.createElement('div');
  t.className = 'toast';
  t.innerHTML = `<svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><polyline points="20,6 9,17 4,12"/></svg> ${msg}`;
  w.appendChild(t);
  setTimeout(() => {
    t.style.transition = '0.18s'; t.style.opacity = '0'; t.style.transform = 'translateY(6px)';
    setTimeout(() => t.remove(), 200);
  }, dur);
}
</script>
</body>
</html>
